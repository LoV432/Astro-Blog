---
const { comment, isReply = false } = Astro.props;
const isAdmin: boolean = comment.isAdminComment == null ? false : true;
const avatar: string = comment.author.avatar == null ? 'https://avatars.dicebear.com/api/identicon/loveingtheairUwU.svg?background=%23ffffff' : comment.author.avatar;
---

<div class={'rounded grid grid-cols-[auto] md:grid-cols-[auto,1fr] ' + (isReply ? 'pl-5' : '')}>
	<article class={'px-6 py-5 mb-6 text-base rounded-md bg-zinc-900 customBorder guest ' + (isReply ? 'md:w-[38.75rem]' : 'md:w-[40rem]')}>
		<footer class="flex items-center mb-2">
			<div class="flex w-full">
				<div aria-labelledby="Commenter Image" class="mr-3 self-center">
					<img class="w-10 h-10 rounded-sm" loading="lazy" src={avatar} alt={comment.author.name} />
				</div>
				<div class="self-center w-full">
					<p class="text-base">
						{comment.author.name}
						{
							isAdmin ? (
								<span class="p-2 pt-[0.55rem] float-right">
									<svg aria-labelledby="Admin" class="w-3.5 h-3.5 fill-rose-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
										<title>Admin</title>
										<path d="M256 0c4.6 0 9.2 1 13.4 2.9L457.7 82.8c22 9.3 38.4 31 38.3 57.2c-.5 99.2-41.3 280.7-213.7 363.2c-16.7 8-36.1 8-52.8 0C57.3 420.7 16.5 239.2 16 140c-.1-26.2 16.3-47.9 38.3-57.2L242.7 2.9C246.8 1 251.4 0 256 0zm0 66.8V444.8C394 378 431.1 230.1 432 141.4L256 66.8l0 0z" />
									</svg>
								</span>
							) : (
								<button class="p-2 pt-[0.55rem] pr-2.5 dropdown dropdown-left float-right">
									<svg xmlns="http://www.w3.org/2000/svg" class="fill-rose-800 w-2.5" viewBox="0 0 448 512">
										<path d="M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z" />
									</svg>
									<span class="sr-only">Report Comment</span>
									<ul tabindex="0" class="dropdown-content menu p-2 shadow border border-rose-600 bg-zinc-900 rounded-box w-36">
										<li>
											<label class="w-28 p-0 place-self-center justify-center text-center active:bg-transparent">
												<input type="checkbox" data-commentid={comment.id} class="hidden cancelReport" />
												<span class="text-green-600 font-extrabold active:bg-green-900 focus:bg-green-900 w-28 py-3 px-4 rounded-md">CANCEL</span>
											</label>
										</li>
										<li>
											<label class="w-28 p-0 place-self-center justify-center text-center active:bg-transparent">
												<input data-commentid={comment.id} class="hidden" />
												<span data-commentid={comment.id} class="text-red-600 font-extrabold active:bg-red-900 w-28 py-3 px-4 rounded-md reportButton">
													REPORT?
												</span>
											</label>
										</li>
									</ul>
								</button>
							)
						}
					</p>
					<time class="commentPostTime text-sm text-gray-600 dark:text-gray-400" data-commentposttime={comment.createdAt}>
						{comment.createdAt}
					</time>
				</div>
			</div>
		</footer>
		<pre aria-label="Comment Content" class="whitespace-pre-wrap mt-3">{comment.content}</pre>
		{
			!isReply ? (
				<span data-threadAuthor={comment.author.name} data-threadID={comment.id} title="Reply to this comment" class="p-2 pt-1 bg-transparent float-right hover:cursor-pointer rounded-full reply-to-comment">
					<svg role="img" aria-labelledby="Reply to this comment" class="w-3.5 h-3.5 fill-rose-800 reply-to-comment-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
						<title>Reply to this comment</title>
						<path d="M205 34.8c11.5 5.1 19 16.6 19 29.2v64H336c97.2 0 176 78.8 176 176c0 113.3-81.5 163.9-100.2 174.1c-2.5 1.4-5.3 1.9-8.1 1.9c-10.9 0-19.7-8.9-19.7-19.7c0-7.5 4.3-14.4 9.8-19.5c9.4-8.8 22.2-26.4 22.2-56.7c0-53-43-96-96-96H224v64c0 12.6-7.4 24.1-19 29.2s-25 3-34.4-5.4l-160-144C3.9 225.7 0 217.1 0 208s3.9-17.7 10.6-23.8l160-144c9.4-8.5 22.9-10.6 34.4-5.4z" />
					</svg>
				</span>
			) : (
				''
			)
		}
	</article>
</div>
<div class="relative after:border-l after:border-zinc-600 after:absolute after:top-0 after:h-[97%] after:w-full after:-z-10 after:rounded-bl-lg">
	{
		comment.children
			.slice(0)
			.reverse()
			.map((replyComment) => <Astro.self comment={replyComment} isReply={true} />)
	}
</div>
